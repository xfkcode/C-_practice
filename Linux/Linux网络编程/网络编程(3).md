# 网络编程(3):shirt: 

## 1. 半关闭:satellite: 

如果一方close，另一方没有close，则认为是半关闭状态  
处于半关闭状态，可以接受数据，但是不能发送数据

【:postbox:】半关闭一定出现在主动关闭的一方

#### shutdown函数

```C
#include <sys/socket.h>
int shutdown(int sockfd, int how);
```

- 函数说明：关闭全部或部分全双工链接
- 参数说明：
  - `sockfd` ：文件描述符
  - `how` ：
    - SHUT_RD：读（接收）禁止
    - SHUT_WR： 写（发送）禁止
    - SHUT_RDWR： 读写禁止
- 返回值：
  - 成功：返回 0 
  - 失败：返回 -1，并设置 `errno` 

【:shopping_cart:】shutdown和close的区别  
             1.shutdown可实现半关闭，close不可以  
		     2.shutdown不考虑文件描述符的引用计数，直接关闭  
			    close考虑文件描述符的引用计数，只有减小到0才被真正关闭

【:atm:】长连接&短连接  
		    长连接：连接建立好之后，一直保持连接不关闭  
		    短连接：连接使用完之后立刻关闭

## 2. 心跳包:heart_decoration: 

检查与对方的网络连接是否正常  
连接异常先关闭后重建  
一般用于长连接

【:construction:】方法1  
			 不能实时检测网络情况

```C
keepAlive = 1;
setsockopt(lfd, SOL_SOCKET, SO_KEEPALIVE, (void*)&keepAlive, sizeof(keepAlive));
```

【:blue_heart:】方法2  
 自定义协议： `4Byte数据长度 + 数据部分`   
			  A端发送 >>> `0000+AAAA`    
			  B端回复 >>> `0000+BBBB`    
 若A端多次发送B端不回复则连接异常：  
	          先关闭原连接  
	          再重建新连接

## 3. 高并发服务器:shopping_cart: 
