# 线程同步:

## 1. 互斥锁

【:ticket:】互斥锁使用步骤  
             1.定义互斥锁变量 `pthread_mutex_t mutex;`  
		     2.在main函数中初始化互斥锁 `pthread_mutex_init(&mutex, NULL);`  
    	     3.在共享资源操作上下加锁/解锁   
		         	`pthread_mutex_lock(&mutex);` 
                  	//共享资源操作代码//  
                 	`pthread_mutex_unlock(&mutex);`  
        	 4.在main函数中销毁互斥锁 `pthread_mutex_destroy(&mutex);` 

```C
  1 //互斥锁测试
  2 #include <stdio.h>
  3 #include <stdlib.h>
  4 #include <string.h>
  5 #include <sys/types.h>
  6 #include <unistd.h>
  7 #include <pthread.h>
  8 
  9 //定义互斥锁
 10 pthread_mutex_t mutex;
 11 
 12 void *threadfunc1(void *arg)
 13 {
 14     while(1)
 15     {
 16         //加锁
 17         pthread_mutex_lock(&mutex);
 18         printf("HELLO ");
 19         sleep(rand()%3);
 20         printf("WORLD\n");
 21         //解锁
 22         pthread_mutex_unlock(&mutex);
 23         sleep(rand()%3);
 24     }
 25     pthread_exit(NULL);
 26 }
 27 
 28 void *threadfunc2(void *arg)
 29 {
 30     while(1)
 31     {
 32         pthread_mutex_lock(&mutex);
 33         printf("hello ");
 34         sleep(rand()%3);
 35         printf("world\n");
 36         pthread_mutex_unlock(&mutex);
 37         sleep(rand()%3);
 38     }
 39     pthread_exit(NULL);
 40 }
 41 
 42 int main()
 43 {
 44     //随机数
 45     srand(time(NULL));
 46     //互斥锁初始化
 47     pthread_mutex_init(&mutex, NULL);
 48 
 49     pthread_t thread1;
 50     int ret = pthread_create(&thread1, NULL, threadfunc1, NULL);
 51     if (ret!=0)
 52     {
 53         printf("pthread_create error, [%s]\n", strerror(ret));
 54         return -1;
 55     }
 56 
 57     pthread_t thread2;
 58     ret = pthread_create(&thread2, NULL, threadfunc2, NULL);
 59     if (ret!=0)
 60     {
 61         printf("pthread_create error, [%s]\n", strerror(ret));
 62         return -1;
 63     }
 64 
 65     pthread_join(thread1, NULL);
 66     pthread_join(thread2, NULL);
 67 
 68     //销毁互斥锁
 69     pthread_mutex_destroy(&mutex);
 70 
 71     return 0;
 72 }

 >>>>执行结果1（不加互斥锁）
 [xfk@centos PTHREAD]$ ./pthread_mutex 
 hello world
 HELLO WORLD
 hello HELLO WORLD
 HELLO world
 ^C
 >>>>执行结果2（加互斥锁）
 [xfk@centos PTHREAD]$ ./pthread_mutex 
 hello world
 HELLO WORLD
 HELLO WORLD
 ^C
```

### 死锁



## 2. 读写锁

## 3. 条件变量

## 4. 信号量